\documentclass[paper=a4, fontsize=11pt]{scrartcl}

\usepackage[utf8]{inputenc}
\usepackage[ngerman,english]{babel}
\usepackage{hyperref}
\usepackage{wrapfig}
\usepackage{minted}
\usepackage{multicol}
\usepackage{color}
\usepackage{pifont}
\usepackage{tikz}
\usepackage{amsmath}

\title{Autonomous Parking Scenario}
\author{Alexander Reisner \href{mailto:alexander.reisner@tum.de}{\texttt{alexander.reisner@tum.de}} \and
Alexander Weidinger \href{mailto:alexander.weidinger@tum.de}{\texttt{alexander.weidinger@tum.de}} \and
David Werner \href{mailto:david.werner@tum.de}{\texttt{david.werner@tum.de}}}
\date{\today}

\begin{document}

% title page
\maketitle
\newpage

% toc
\tableofcontents
\newpage

\section{General}
\begin{itemize}
  \item Task description
  \item Overview diagram
  \item Dataflow diagram (sequence diagram?)
\end{itemize}
\section{SpeedDreams 2}
\begin{itemize}
  \item What is SpeedDreams 2?
  \item Why do we need SpeedDreams 2?
  \item What changes do we need to make?
\end{itemize}
\subsection{Proximity Sensor}
\begin{itemize}
  \item Related work (Sensor by the Simulated Car Racing Championship, ...)
  \item Idea and approach
  \item Implementation details and problems (+ solutions)
\end{itemize}
\subsection{Starting Grid}
\begin{itemize}
  \item We need it to get reproducible results each run
  \item Idea and approach
  \item Implementation details
\end{itemize}
\subsection{Driving bots}
\subsubsection{human}
\begin{itemize}
  \item Data exchange between SD2 and S/A VM
  \item Driving logic (brake and accel if needed to maintain given speed)
\end{itemize}
\subsubsection{usr}
\begin{itemize}
  \item Now a simple parked car (accel=0, brake=1, steer=0)
  \item Should be moved to own bot
\end{itemize}
\subsection{Data exchange with S/A VM}
\begin{itemize}
  \item Protocol (protobuf, 4 byte message length header + message, tcp socket)
  \item Problem Nagle's algorithm $\rightarrow$ disable it via TCP\_NODELAY
\end{itemize}
\section{SimCoupler}
\begin{itemize}
  \item Why did we drop SimCoupler
  \item Where do we need to make changes to integrate it
  \item Shared protobuf module problem and possible solution
\end{itemize}
\section{S/A VM}
\subsection{Data exchange with speedDreams 2}
  \subsubsection{Protobuf}
Google Protobuf is a protocol for network data exchange.
The newest version can be found \href{https://github.com/google/protobuf}{here}.
To exchange data, protobuf files habe to be created beforehand.
One of the protobuf files designed during this pratical course looks like this: 
  \begin{figure}[!h]
  \begin{minipage}{0.5\textwidth}
  \centering
    \begin{minted}[fontsize=\tiny]{protobuf}
	syntax = "proto3";
	package protobuf;
	
	import "sensor.proto";
	import "wheel.proto";
	import "specification.proto";
	
	message State {
	  repeated Sensor sensor = 1;
	  repeated Wheel wheel = 2;
	  Specification specification = 3;
	  float steer = 4;
	  float brakeCmd = 5;
	  float accelCmd = 6;
	}
    \end{minted}
  \end{minipage}
  \begin{minipage}{0.5\textwidth}
    \begin{itemize}
\item The version of the syntax is defined.
\item All packages and imports are declared.
\item The message is constructed. Attributes can be other Protobuf messages, simple datatypes, like int or float, or a list "repeated" of any attributes named.
    \end{itemize}
  \end{minipage}
    \caption{\tiny state.proto}
  \end{figure}
  \subsubsection{TCP/IP}
Before any network interaction can take place, the network has to be initialized. Therefore the library lwip is usually needed. But since the mosquitto library already initializes lwip, another initialization within the components code caused lwip and moquitto to freeze.\newline
Furthermore dhcp and manuall ip configuration have to be seperated in the initialization, since dhcp ip assignement takes up to 10 seconds, however manuall ip assignement takes place instantly.
  \subsection{Our protocol}
To be able to change data, some preparation needs to be done beforehand. Since it is not usefull to send data without knowledge over its size, some kind of a protocol around the protobuf data exchange had to be designed. Therefore it was decided to send a 4 byte long value which contains the size of the following protobuf state, is sent to start the actual exchange. Any other messages are dropped.
  \subsubsection{deserialize}
  \subsubsection{serialize}
  \subsubsection{Nagel's algorithm}
  \subsubsection{Do not wait for answer of ECU}
\subsection{Data exchange with ECU}
  \subsubsection{MQTT/mosquitto/publish subscribe}
  \subsubsection{callbacks}
  \subsubsection{lwip mosquitto foo}
\section{ECU}
\section{Misc}
\begin{itemize}
  \item Porting of the mosquitto library % FIXME do we really want to add the mosquitto port in our documentation?
\end{itemize}

\end{document}
